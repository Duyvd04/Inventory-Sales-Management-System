<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <!-- Th√™m Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <!-- Th∆∞ vi·ªán Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>

      /* üîπ CƒÉn ch·ªânh l·∫°i b·ªë c·ª•c */
    .chart-container {
      width: 100%;
      max-width: 450px; /* üìå ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc h·ª£p l√Ω */
      height: 350px;
      margin: auto;
    }
    .section-title {
      font-weight: bold;
      font-size: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    .total-customers-box {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
      display: inline-block;
      margin-bottom: 15px;
    }
  </style>
</head>
<body class="container mt-4">

<!-- üü¢ Ti√™u ƒë·ªÅ -->
<h2 class="text-center fw-bold mb-3">üìä B√°o C√°o Kh√°ch H√†ng</h2>

<!-- üü¢ Form ch·ªçn ng√†y + n√∫t c·∫≠p nh·∫≠t (CƒÉn ch·ªânh chu·∫©n) -->
<form action="/Admin/report/addRange" method="post" class="row justify-content-center mb-4">
  <div class="col-md-3">
    <label class="form-label fw-bold">T·ª´ ng√†y:</label>
    <input type="date" id="fromDate" name="fromDate" value="${fromDate}" class="form-control" required>
  </div>
  <div class="col-md-3">
    <label class="form-label fw-bold">ƒê·∫øn ng√†y:</label>
    <input type="date" name="toDate" value="${toDate}" class="form-control" required>
  </div>
  <div class="col-md-2 d-flex align-items-end">
    <button type="submit" class="btn btn-success custom-btn">C·∫≠p nh·∫≠t</button>
  </div>
</form>

<!-- üîπ Hi·ªÉn th·ªã t·ªïng s·ªë kh√°ch h√†ng (ƒê∆∞a l√™n tr√™n, kh√¥ng n·∫±m gi·ªØa bi·ªÉu ƒë·ªì) -->

<!-- üìä Xu·∫•t b√°o c√°o -->
<a href="/Admin/report/export/excel" class="btn btn-success mt-4">
  <i class="bi bi-file-earmark-excel"></i> Xu·∫•t Excel
</a>
<div class="text-center">
  <span class="total-customers-box">üìå <b>T·ªïng kh√°ch h√†ng:</b> <span style="color: #28a745;">[[${totalCustomers}]]</span></span>
</div>

<!-- Hi·ªÉn th·ªã th√¥ng b√°o -->
<div th:if="${message}" class="alert alert-success" role="alert" th:text="${message}"></div>


<!-- Form X√≥a Danh M·ª•c -->
<form th:action="@{/Admin/report/deleteAll}" method="post">
  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
      <tr>
        <th class="text-center">
          <input type="checkbox" id="selectAll" class="form-check-input">
        </th>
        <th>STT</th>
        <th>Kh√°ch H√†ng</th>
        <th>T·ªïng ƒê∆°n H√†ng</th>
        <th>T·ªïng Chi Ti√™u</th>
        <th>T·ªïng S·∫£n Ph·∫©m</th>
        <th>Tr·∫°ng Th√°i Thanh To√°n</th>
        <th>Lo·∫°i KH</th>
        <th>Ng√†y ƒê∆°n H√†ng G·∫ßn Nh·∫•t</th>
        <th>H√†nh ƒë·ªông </th>
      </tr>
      </thead>
      <tbody>
      <!-- Ki·ªÉm tra danh s√°ch c√≥ r·ªóng kh√¥ng -->
      <tr th:if="${#lists.isEmpty(customerReports)}">
        <td colspan="9" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
      </tr>

      <tr th:each="report, c : ${customerReports.content}">
        <td class="text-center">
          <input type="checkbox" class="form-check-input" th:name="selectedCustomers" th:value="${report.reportId}">
        </td>
        <td th:text="${c.count}"></td>
        <td th:text="${report.customer.customerName}"></td>
        <td th:text="${report.totalOrders}"></td>
        <td th:text="${#numbers.formatDecimal(report.totalSpent, 0, 'COMMA', 0, 'POINT') + ' VND'}"></td>
        <td th:text="${report.totalProductsPurchased}"></td>
        <td th:text="${report.lastPaymentStatus != null ? report.lastPaymentStatus.getDescription() : 'Kh√¥ng x√°c ƒë·ªãnh'}"></td>
        <td th:text="${report.spendingCategory}"></td>
        <td th:text="${#temporals.format(report.lastOrderDate, 'dd/MM/yyyy HH:mm')}"></td>
        <td class="text-center">
          <button type="button" class="btn btn-warning btn-sm"
                  data-bs-toggle="modal"
                  th:data-bs-target="'#editReportModal-' + ${report.reportId}">
            <i class="fas fa-edit"></i> S·ª≠a
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <button type="submit" class="btn btn-danger btn-sm mt-3">
    <i class="bi bi-trash"></i> X√≥a danh m·ª•c
  </button>
</form>

<!-- Modal Ch·ªânh S·ª≠a -->
<div th:each="report : ${customerReports}" th:id="'editReportModal-' + ${report.reportId}" class="modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ch·ªânh S·ª≠a B√°o C√°o</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form th:action="@{/Admin/report/edit}" method="post">
          <input type="hidden" name="reportId" th:value="${report.reportId}">

          <div class="mb-3">
            <label class="form-label">T·ªïng ƒê∆°n H√†ng</label>
            <input type="number" class="form-control" name="totalOrders" th:value="${report.totalOrders}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">T·ªïng Chi Ti√™u (VND)</label>
            <input type="number" class="form-control" name="totalSpent" th:value="${report.totalSpent}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">T·ªïng S·∫£n Ph·∫©m</label>
            <input type="number" class="form-control" name="totalProductsPurchased" th:value="${report.totalProductsPurchased}" required>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-success">L∆∞u</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">

    <!-- N√∫t "Tr∆∞·ªõc" -->
    <li class="page-item" th:classappend="${customerReports.first} ? 'disabled'">
      <a class="page-link" th:href="@{/Admin/report(page=${customerReports.number - 1})}"
         aria-label="Tr∆∞·ªõc" th:if="${!customerReports.first}">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <!-- Hi·ªÉn th·ªã s·ªë trang v·ªõi d·∫•u "..." n·∫øu c√≥ nhi·ªÅu trang -->
    <li th:each="i : ${#numbers.sequence(0, customerReports.totalPages - 1)}"
        class="page-item" th:classappend="${i == customerReports.number} ? 'active'">
      <a class="page-link" th:href="@{/Admin/report(page=${i})}" th:text="${i + 1}"></a>
    </li>

    <!-- N√∫t "Sau" -->
    <li class="page-item" th:classappend="${customerReports.last} ? 'disabled'">
      <a class="page-link" th:href="@{/Admin/report(page=${customerReports.number + 1})}"
         aria-label="Sau" th:if="${!customerReports.last}">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
